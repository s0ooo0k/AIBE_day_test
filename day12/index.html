<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë¬´ì—‡ì´ë“  ë¬¼ì–´ë³´ì„¸ìš”â“</title>
    <link
      rel="icon"
      type="image/png"
      href="./favicon/favicon-96x96.png"
      sizes="96x96"
    />
    <link rel="icon" type="image/svg+xml" href="./favicon/favicon.svg" />
    <link rel="shortcut icon" href="./favicon/favicon.ico" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="./favicon/apple-touch-icon.png"
    />
    <link rel="manifest" href="./favicon/site.webmanifest" />
    <!-- OG Image -->
    <meta property="og:title" content="ë¬´ì—‡ì´ë“  ë¬¼ì–´ë³´ì„¸ìš”" />
    <meta
      property="og:description"
      content="AIëŠ” ë§ŒëŠ¥ì…ë‹ˆë‹¤! ì¹œì ˆí•œ ë‹µë³€ì„ ì œê³µí•  ê²ƒì…ë‹ˆë‹¤"
    />
    <meta
      property="og:image"
      content="https://raw.githubusercontent.com/s0ooo0k/AIBE_day_test/refs/heads/main/day12/img.png"
    />
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Archivo+Narrow:ital,wght@0,400..700;1,400..700&family=Kumar+One&family=Noto+Sans+KR:wght@100..900&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap");
    </style>

    <link rel="stylesheet" href="style.css" />
  </head>

  <body>
    <!-- 
    1. CRUD -> Persistence(ì˜ì†ì„±) -> JPA DB -> Storage -> BOM (LocalStorage, SessionSTroage) 
    2. LLM - ìƒì„±í˜• AI - ì¶”ì²œ ì»¨í…ì¸ , ìš”ì•½, ë²ˆì—­, ... -> í¬í•¨ -> API -> ë„¤íŠ¸ì›Œí¬ ìš”ì²­(fetch, axios) -> ë¹„ë™ê¸° í”„ë¡œê·¸ë¨
    3. API -> API Key, Dat -> ì„ì˜ì ì¸ ìˆ˜ì •, Secure ì½”ë”© -> CORS(Proxy, WhiteList -> ì„œë²„ ìì²´ê°€ ì ‘ê·¼ì„ í—ˆìš© -> ì„¤ì¹˜, ì„¤ì •), API KEY - ì‚¬ìš©ëŸ‰, ë¹„ìš© -> ë…¸ì¶œ(í•´í‚¹)
    4. íŒŒì¼ ë‹¤ë£¨ê¸° -> WAS, WS -> AWS S3, Free Tier, Baas / Headless CMS -> 
    ê°ì²´ ìŠ¤í† ë¦¬ì§€ -> 1) ì§ì ‘ í´ë¼ìš°ë“œ ì¸ìŠ¤í„´ìŠ¤ì— ì—°ê²° 2) í´ë¼ìš°ë“œì—ì„œ ì œê³µí•˜ëŠ” ë„¤íŠ¸ì›Œí¬ APIë¥¼ ì‚¬ìš©í•´ì„œ ì›ê²©ìœ¼ë¡œ ì „ë‹¬ 
    -> ì—¬í–‰ => 'ì—¬í–‰'ì€ ê±°ë“¤ë¿,
    AI ì‹œëŒ€ ê°œë°œìëŠ” ì–´ëŠ ë°©í–¥ìœ¼ë¡œ ë‚˜ì•„ê°€ì•¼ í•˜ëŠ”ê°€? -> ì‹œê°„ì´ ë‚¨ê±°ë‚˜, ë‹¤ì–‘í•œ ê±¸ í•  ê²ƒì´ë‹¤
    -> ë””ìì¸, ì˜ì—…, (<- ì–´ëŠì •ë„ ê¸°ì§ˆì  ì˜ì—­) ê¸°íš, ì‚¬ì—…, ... 
    ê¸°íš, ì‚¬ì—… => ì—¬í–‰ => ë¸”ë¡œê·¸? ì§€ë„?
    => ì–´í”Œë¦¬ì¼€ì´ì…˜ ìˆœìœ„ë¥¼ ë³´ê±°ë‚˜, ìš”ìƒˆ ë‰´ìŠ¤ë¥¼ë³´ê³ , ê±°ê¸°ì— ì´ìŠˆë¥¼ ê°€ì ¸ì˜¨ ë‹¤ìŒ ê·¸ëƒ¥ ì—¬í–‰ì„ ë¶™ì´ê³ ,
    => ê·¸ë¦¬ê³  ìœ„ì— 4ê°€ì§€ë¥¼ ë¶™ì—¬ ê°œë°œì„ í•˜ê¸° => í¬íŠ¸í´ë¦¬ì˜¤

    (1) íŠ¸ë Œë“œ, (ì „í˜•ì ì´ì§€ë§Œ ê°•ë ¥í•œ) ì‚¬ëŒì˜ ìš•ë§ì„ ì£¼ì œì— ë¶™ì´ë˜ê°€
    (2) í•˜ëŠ” ê¹€ì— ë‹¤ë¥¸ ì‚¬ëŒë“¤ì´ ë„ë‹¬í•˜ì§€ ëª»í•œ, í˜¹ì€ ì‚¬ì—…ì„±ì´ ì—†ì–´ ë³´ì—¬ ì‚¬ì´ë“œí”„ë¡œì íŠ¸ë‚˜ ì¸ë”” ê°œë°œì´ ì•„ë‹ˆë©´ ì•ˆí• ë§Œí•œ ê²ƒ. => 5, 6ì¸ => ì§„ì§œ ì¬ë°Œê³  ê´œì°®ì€ ê²ƒ ë‚˜ì˜´
-->

    <!-- 1ë‹¨ê³„ : (ìë™ ì €ì¥ ì—†ì´) DOM í‘œí˜„í•˜ëŠ” ê°œë… -->
    <div>
      <h1>ë¬´ì—‡ì´ë“  ë¬¼ì–´ë³´ì„¸ìš”â“</h1>
      <p>
        ì´ ì„œë¹„ìŠ¤ëŠ” ë‹¹ì‹ ì˜ ë§ŒëŠ¥ì…ë‹ˆë‹¤! <br />
        ê¶ê¸ˆí•œ ë‚´ìš©ì„ ì§ˆë¬¸í•´ë³´ì„¸ìš”!<br />
        ì˜ˆì‹œ : í›Œë¥­í•œ ê°œë°œìê°€ ë˜ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ ë ê¹Œìš”?<br />
        ì˜ˆì‹œ : 2025ë…„ í•œêµ­ ì‹œë¦¬ì¦ˆ ìš°ìŠ¹ ì•¼êµ¬íŒ€ì€ ì–´ë””ì¼ê¹Œìš”?
      </p>
      <p>êµ¬í˜„ ë°©ì‹ì´ ê¶ê¸ˆí•˜ì‹œë‹¤ë©´ => <a href="howto.html">READ ME</a></p>
    </div>
    <header></header>
    <form id="controller">
      <label
        >ëª¨ë¸ :
        <select name="modelOption">
          <option value="1">gemini</option>
          <option value="2">deepseek</option>
        </select>
      </label>
      <br />
      <textarea name="textData" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
      <button>ì§ˆë¬¸í•˜ê¸°</button>
    </form>
    <div id="container"></div>
    <button id="resetButton">ë¦¬ì…‹</button>

    <script>
      function _() {
        const container = document.querySelector("#container");
        const form = document.querySelector("#controller");
        const resetButton = document.querySelector("#resetButton");

        // í•œì¤„ë¡œ ì¤„ì¼ ìˆ˜ ìˆë‹¤!
        resetButton.addEventListener("click", () => (data.length = 0));

        // forë¥¼ í™œìš©í•´ì„œ ë°ì´í„°ë¥¼ ì§€ìš°ëŠ” ë°©ë²•ë²•
        //  resetButton.addEventListener("click", resetStorageAndContainer);
        //function resetStorageAndContainer() {
        // localStorage.clear();
        // container.innerHTML = "";
        // const size = data.length;
        //  for (let i = 0; i <think size; i++) {
        //     data.pop();
        //  }
        //}

        // ë¦¬ì•¡í‹°ë¸Œí•˜ê²Œ êµ¬í˜„ ê°€ëŠ¥
        // Proxyë¡œ ì—®ì€ í›„ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë©´, ë³€í™”ê°€ ì¼ì–´ë‚¬ì„ ë•Œ ì‘ë™ì„ ì‹œí‚¬ ìˆ˜ ìˆìŒ
        const data = new Proxy([], {
          // proxy ê°ì²´, í‚¤, ê°’ -> ê°ì²´ì— í‚¤ë¥¼ í†µí•´ ê°’ì„ ë³€í™˜í•˜ëŠ” ê²ƒì´ ì¼ì–´ë‚˜ë©´ ì¼ë‹¨ ê·¸ê±¸ ì²˜ë¦¬í•¨
          set(target, property, value) {
            target[property] = value;
            updateContainer(); // data ë°°ì—´ì— ì¶”ê°€/ìˆ˜ì •ì‹œ ë°˜ì‘
            updateStorage(target);
            return true;
          },
        });

        function onMounted() {
          // const storageData = localStorage.getItem("myData"); // string | null;
          // const storageDataParsed = JSON.parse(storageData);
          // nullì´ë©´ ì—¬ì „íˆ null -> Objectë‚˜ Arrayë¡œ ë³€í™˜ ê°€ëŠ¥í•œ stringì´ë¼ë©´ ë³€í™˜í•´ì¤Œ / ì•„ë‹ˆë©´ error or undefined
          // const storageDataParsedSafe = storageDataParsed ?? [];
          // null ë³‘í•© ì—°ì‚°ì(??) -> ë§Œì•½ null, undefined ê°™ì€ ë¹„ì–´ìˆëŠ” ì¢…ë¥˜ -> ë‹¤ìŒì˜ í”¼ì—°ì‚°ì(ì—¬ê¸°ì„œëŠ” [])ë¥¼ ë„£ì–´ë¼
          // data.push(...storageDataParsedSafe);
          // data.push();
          // ì´ ëª¨ë“  ê±¸ í•œ ì¤„ë¡œ í•©ì¹œë‹¤ë©´?
          data.push(...(JSON.parse(localStorage.getItem("myData")) ?? []));
        }
        onMounted();

        // 1. ìµœì´ˆ í™”ë©´ì´ ë¶ˆëŸ¬ì™€ì¡Œì„ ë•Œì˜ ë¡œë”©
        // 2. localStroage -> ì§ë ¬í™”/ì—­ì§ˆë ¬í™”, ë¹„ì—ˆì„ ë•Œ
        // 3. uuid / seq -> íŠ¹ì •í•œ ë°ì´í„°ì— ëŒ€í•œ ì§€ì • ì‚­ì œ
        // 4. ì™„ì „ ì‚­ì œ(ë¦¬ì…‹)

        function updateContainer() {
          container.innerText = ""; // ë°°ì—´ ì¼ê´„ ì¶”ê°€, ìƒì–´ë²„ë¦¬ê¸°(ì´ˆê¸°í™”)
          for (const d of data) {
            const tmp = document.createElement("div"); // temp...
            tmp.textContent = d.text;

            // ì‚­ì œ êµ¬í˜„
            const deleteButton = document.createElement("button");
            deleteButton.textContent = "ì‚­ì œ";
            deleteButton.addEventListener("click", () => {
              // í•´ë‹¹ idë§Œ ì‚­ì œí•˜ê¸° ìœ„í•´ì„œ,
              // idê°€ ì•„ë‹Œ ê±¸ ì €ì¥í•˜ê³  ë‹¤ì‹œ ë„ìš°ëŠ” ë°©ë²•ë²•
              const filtered = data.filter((value) => value.id !== d.id);
              // console.log(filtered);
              // ë‹¤ ì§€ìš°ê³ , filteredë¡œ ë‚¨ëŠ” ê±° ë‹¤ì‹œ ë„£ì–´ì£¼ê¸°
              // ì´ ë°©ë²•ì´ ê°€ì¥ jsìŠ¤ëŸ½ë‹¤!
              data.length = 0;
              data.push(...filtered);
            });
            // LLM ì‘ë‹µ
            if (d.reply) {
              const box = document.createElement("div");
              const reply = document.createElement("code");
              box.appendChild(reply);
              // CSS in JS, Styled Component
              box.style.padding = "12px";
              box.style.margin = "4px";
              box.style.backgroundColor = "beige";
              box.style.border = "1px solid black";
              reply.textContent = d.reply;
              tmp.appendChild(box);
            }
            tmp.appendChild(deleteButton);
            container.appendChild(tmp);
          }
        }

        function updateStorage(target) {
          // console.log(target);
          // localStorage.setItem("myData", target);
          // console.log(localStorage.get)
          // ì´ë ‡ê²Œ í•˜ë©´ object Object(ê°ì²´)ê°€ ë‚˜ì˜´ -> ì§ë ¬í™”ê°€ í•„ìš”
          // ë¬¸ìì—´ë¡œ ì§ë ¬í™”
          localStorage.setItem("myData", JSON.stringify(target));
          console.log(localStorage.getItem("myData"));
          // "text" í˜•íƒœë¡œ ë“¤ì–´ì˜¨ë‹¤
        }

        async function handleForm(event) {
          event.preventDefault();
          const formData = new FormData(form);
          // uuid(ë²„ì „ì— ë”°ë¼ ê³µí†µ ê·œì¹™ì´ ìˆëŠ”ë°, ì›¬ë§Œí•˜ë©´ ì•ˆê²¹ì¹¨), seq(1ì”© ì¦ê°€)
          // idëŠ” ì£¼ë¡œ ìˆœì„œ(ì‹œí€€ìŠ¤), ì‹œê°„, í•´ì‹œ,
          // í•œêµ­ì‹œê°„ UTC+9, KST, Date.now() -> 1970.01.01.00:00:00 ms :0, (UTC +0)
          // console.log(displayData);
          const text = formData.get("textData");
          let reply;
          switch (formData.get("modelOption")) {
            case "1":
              reply = `ğŸ‘¬ Gemini : ${await makeReply(text)}`;
              break;
            case "2":
              reply = `ğŸ‘€ DeepSeek : ${await makeReply2(text)}`;
              break;
            default:
              alert("ë¹„ì •ìƒì ì¸ ì ‘ê·¼!");
              throw new Error("ì•Œ ìˆ˜ ì—†ëŠ” ì—ëŸ¬!");
              break;
          }
          // const reply = await makeReply(text);
          // const reply2 = await makeReply2(text);
          const displayData = {
            id: Date.now(),
            text,
            reply, // ë‹¨ì¶• ë¬¸ë²• ì¤‘ í•˜ë‚˜(property = keyì˜ ì´ë¦„ê³¼ valueì— ë“¤ì–´ê°€ëŠ” ë³€ìˆ˜ëª…ì´ ê°™ìœ¼ë©´ ë‹¨ì¶• ê°€ëŠ¥)
          };
          data.push(displayData);
        }
        // 3ë‹¨ê³„ : LLM APIë¥¼ ì¨ì„œ ì‘ì„± ë°ì´í„°ì—i ëŒ€í•œ ì¶”ì²œ ìƒì„±, secure coding ì²˜ë¦¬

        async function makeReply(text) {
          const url = "https://sepia-zenith-dichondra.glitch.me/1";
          const response = await fetch(url, {
            method: "POST",

            body: JSON.stringify({
              text: `ë„ˆëŠ” ì„¸ìƒì—ì„œ ê°€ì¥ ì™„ë²½í•œ ë‹µì„ ì£¼ëŠ” aiì•¼. ${text}ì˜ ì§ˆë¬¸ì— ëŒ€í•œ ë‹µì„ ì¹œì ˆí•˜ê²Œ 100ì~300ìë¡œ ì‘ì„±í•´ì¤˜. í•œìë‚˜ ì¼ë³¸ì–´ëŠ” ë‹µë³€ì—ì„œ ë¹¼ì¤˜.ë‹µë³€ ì¤‘ê°„ ì¤‘ê°„ ì´ëª¨ì§€ë„ ë“¤ì–´ê°”ìœ¼ë©´ ì¢‹ê² ì–´.`,
            }),
            headers: {
              "Content-Type": "application/json",
            },
          });
          const json = await response.json();
          //   return json.candidates[0].content.parts[0].text;
          return json.reply;
        }
        async function makeReply2(
          content,
          model = "deepseek-r1-distill-llama-70b"
        ) {
          const url = "https://sepia-zenith-dichondra.glitch.me/2";
          const response = await fetch(url, {
            method: "POST",

            body: JSON.stringify({
              text: `ë„ˆëŠ” ì„¸ìƒì—ì„œ ê°€ì¥ ì™„ë²½í•œ ë‹µì„ ì£¼ëŠ” aiì•¼. ${content}ì˜ ì§ˆë¬¸ì— ëŒ€í•œ ë‹µì„ ì¹œì ˆí•˜ê²Œ 100ì~300ìë¡œ ì‘ì„±í•´ì¤˜. í•œìë‚˜ ì¼ë³¸ì–´ëŠ” ë‹µë³€ì—ì„œ ë¹¼ì¤˜. ë‹µë³€ ì¤‘ê°„ ì¤‘ê°„ ì´ëª¨ì§€ë„ ë“¤ì–´ê°”ìœ¼ë©´ ì¢‹ê² ì–´.`,
            }),
            headers: {
              //   Authorization: `Bearer ${GROQ_API_KEY}`,
              "Content-Type": "application/json",
            },
          });
          const json = await response.json();
          //   return json.choices[0].message.content.split("</think>")[1].trim();
          return json.reply;
        }
        form.addEventListener("submit", handleForm);
      }
      window.onload = _;
      // 1. í•¨ìˆ˜ë¡œ ê°ì‹¸ì„œ ë‹¤ë¥¸ í•¨ìˆ˜ë‚˜, ë‹¤ë¥¸ ë³€ìˆ˜ ë“±ì´ ì™¸ë¶€ì—ì„œ ì ‘ê·¼í•˜ì§€ ëª»í•˜ê²Œ í•œë‹¤.
      // 2. window.onload (BOM) -> html, css ê²ƒë“¤ì´ ëª¨ë‘ ë¡œë“œëœ ë‹¤ìŒì— jsë¥¼ ì‹¤í–‰í•˜ê²Œ í•œë‹¤.
    </script>
  </body>
</html>
