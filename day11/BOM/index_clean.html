<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BOMì˜ MEMO</title>
    <!-- Favicon -->
    <link
      rel="icon"
      type="image/png"
      href="./favicon/favicon-96x96.png"
      sizes="96x96"
    />
    <link rel="icon" type="image/svg+xml" href="./favicon/favicon.svg" />
    <link rel="shortcut icon" href="./favicon/favicon.ico" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="./favicon/apple-touch-icon.png"
    />
    <link rel="manifest" href="./favicon/site.webmanifest" />
    <!-- OG Image -->
    <meta property="og:title" content="Today's Memo ğŸ“" />
    <meta
      property="og:description"
      content="ì„±ê³µ? ì´ì œ ì—ëŸ¬ í•´ê²° TILì„ ì‘ì„±í•©ì‹œë‹¤..."
    />
    <meta
      property="og:image"
      content="https://raw.githubusercontent.com/s0ooo0k/AIBE_day_test/refs/heads/main/day11/BOM/draw.jpg"
    />
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Archivo+Narrow:ital,wght@0,400..700;1,400..700&family=Kumar+One&family=Noto+Sans+KR:wght@100..900&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap");
    </style>

    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div>
      <h1>Today's MEMO</h1>
      <p class="main-text-p">
        ë©”ëª¨ë¥¼ ë‹¤ì‹œ ë³´ê³  ì‹¶ë‹¤ë©´ ê¼­! "ë¡œì»¬ ì €ì¥"ì„ í´ë¦­í•˜ì„¸ìš” <br />
        *ì£¼ì˜! ì‚­ì œë¥¼ ëˆ„ë¥´ë©´ ë©”ëª¨ê°€ ì˜ì›íˆ ì‚¬ë¼ì§‘ë‹ˆë‹¤.
      </p>
    </div>
    <div class="form-body">
      <form id="controller" class="form-style">
        <label for="">
          ë©”ëª¨ ë‚´ìš©ì„ ì‘ì„±í•˜ì„¸ìš”!
          <input id="textInput" name="memoText" type="text" />
        </label>
        <label for="">
          ë§í¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”!
          <input name="memoLink" type="url" />
        </label>
        <label for="">
          ë°°ê²½ ìƒ‰ìƒì„ ì„ íƒí•˜ì„¸ìš”!
          <input id="colorInput" name="memoBgColor" type="color" />
        </label>
        <button class="btn-btnstyle">ë§Œë“¤ê¸°</button>
      </form>
    </div>
    <section id="view"></section>

    <script>
      // api ë°°í¬
      async function onload() {
        async function useGemeni() {
          const url = "https://deadpan-past-calculator.glitch.me";
          const response = await fetch(url);
          return await response.text();
        }
        document.querySelector("#textInput").value = await useGemeni();

        // ëœë¤ ë°°ê²½ìƒ‰ìƒ‰
        function goodBgColor() {
          return `#${[...Array(3)]
            .map(() => Math.floor(Math.random() * 56) + 200)
            .map((v) => v.toString(16).padStart(2, "0"))
            .join("")}`;
        }
        document.querySelector("#colorInput").value = goodBgColor();

        // ë©”ëª¨ ì¶”ê°€ê°€
        const memoData = [
          ...(JSON.parse(localStorage.getItem("memoStorage")) ?? []),
        ];

        function drawMemo() {
          const view = document.querySelector("#view");
          view.innerHTML = "";
          for (const memo of memoData) {
            // ë©”ëª¨ ì¶”ê°€
            const memoElement = document.createElement("div");
            memoElement.classList.add("memo-box");
            memoElement.textContent = memo.text;
            memoElement.style.backgroundColor = memo.bgColor;
            view.appendChild(memoElement);

            //ë²„íŠ¼ ì»¨í…Œì´ë„ˆ ìƒì„±
            const buttonContainer = document.createElement("div");
            buttonContainer.classList.add("button-container");

            // ë²„íŠ¼ í™œìš© ë©”ëª¨ ì‚­ì œì œ
            const deleteButton = document.createElement("button");
            deleteButton.classList.add("btn-btnstyle-2");
            deleteButton.textContent = "ì‚­ì œ";
            deleteButton.addEventListener("click", () => {
              // memoData ë°°ì—´ì—ì„œ í•´ë‹¹ ë©”ëª¨ì˜ ì¸ë±ìŠ¤ë¥¼ ì°¾ê¸°
              // DOM + ë¡œì»¬ ëª¨ë‘ ì‚­ì œ
              const index = memoData.indexOf(memo);
              if (index !== -1) {
                memoData.splice(index, 1); // ë°°ì—´ì—ì„œ ì‚­ì œ
              }
              // localStorageì— ì—…ë°ì´íŠ¸ëœ ë°°ì—´ ë‹¤ì‹œ ì €ì¥
              localStorage.setItem("memoStorage", JSON.stringify(memoData));
              // DOMì—ì„œ ì‚­ì œ
              memoElement.remove();
            });
            buttonContainer.appendChild(deleteButton);

            // ë¡œì»¬ ì €ì¥ ë²„íŠ¼
            const localSaveButton = document.createElement("button");
            localSaveButton.textContent = "ë¡œì»¬ ì €ì¥";
            localSaveButton.classList.add("btn-btnstyle-2");
            localSaveButton.addEventListener("click", () => {
              localStorage.setItem(
                "memoStorage",
                JSON.stringify([
                  ...(JSON.parse(localStorage.getItem("memoStorage")) ?? []),
                  memo,
                ])
              );
            });
            buttonContainer.appendChild(localSaveButton);
            // ì„¸ì…˜ ì €ì¥ ë²„íŠ¼
            const sessionSaveButton = document.createElement("button");
            sessionSaveButton.classList.add("btn-btnstyle-2");
            sessionSaveButton.textContent = "ì„¸ì…˜ ì €ì¥";
            sessionSaveButton.addEventListener("click", () => {
              sessionStorage.setItem(
                "memoStorage",
                JSON.stringify([
                  ...(JSON.parse(sessionStorage.getItem("memoStorage")) ?? []),
                  memo,
                ])
              );
            });
            buttonContainer.appendChild(sessionSaveButton);

            // ë§í¬ ë²„íŠ¼ì„ ì¶”ê°€(ìƒˆ ì°½ ì—´ê¸°, í˜„ì¬ ì°½ ì—´ê¸°)
            if (memo.link) {
              const newLinkButton = document.createElement("button");
              newLinkButton.classList.add("btn-btnstyle-2");
              newLinkButton.textContent = "ìƒˆ ì°½";
              buttonContainer.appendChild(newLinkButton);

              const nowLinkButton = document.createElement("button");
              nowLinkButton.classList.add("btn-btnstyle-2");
              nowLinkButton.textContent = "í˜„ì¬ ì°½";
              buttonContainer.appendChild(nowLinkButton);

              nowLinkButton.addEventListener(
                "click",
                () => (location.href = memo.link)
              );
              newLinkButton.addEventListener("click", () =>
                window.open(memo.link)
              );
            }
            memoElement.appendChild(buttonContainer);
          }
        }

        const controller = document.querySelector("#controller");
        // formì˜ submitìœ¼ë¡œ ì‹¤í–‰í•˜ê¸°
        controller.addEventListener("submit", function (event) {
          event.preventDefault();
          const form = new FormData(controller);
          const memo = {};
          memo.text = form.get("memoText");
          memo.bgColor = form.get("memoBgColor");
          memo.link = form.get("memoLink");
          memoData.push(memo);

          drawMemo();
        });
        drawMemo();
      }
      onload();
    </script>
  </body>
</html>
