<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BOMì˜ MEMO</title>
    <!-- Favicon -->
    <link
      rel="icon"
      type="image/png"
      href="./favicon/favicon-96x96.png"
      sizes="96x96"
    />
    <link rel="icon" type="image/svg+xml" href="./favicon/favicon.svg" />
    <link rel="shortcut icon" href="./favicon/favicon.ico" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="./favicon/apple-touch-icon.png"
    />
    <link rel="manifest" href="./favicon/site.webmanifest" />
    <!-- OG Image -->
    <meta property="og:title" content="Today's Memo ğŸ“" />
    <meta
      property="og:description"
      content="ì„±ê³µ? ì´ì œ ì—ëŸ¬ í•´ê²° TILì„ ì‘ì„±í•©ì‹œë‹¤..."
    />
    <meta
      property="og:image"
      content="https://raw.githubusercontent.com/s0ooo0k/AIBE_day_test/refs/heads/main/day11/BOM/draw.jpg"
    />
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Archivo+Narrow:ital,wght@0,400..700;1,400..700&family=Kumar+One&family=Noto+Sans+KR:wght@100..900&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap");
    </style>

    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div>
      <h1>Today's MEMO</h1>
      <p class="main-text-p">
        ë©”ëª¨ë¥¼ ë‹¤ì‹œ ë³´ê³  ì‹¶ë‹¤ë©´ "ë¡œì»¬ ì €ì¥"ì„ í´ë¦­í•˜ì„¸ìš” <br />
        *ì£¼ì˜! ì‚­ì œë¥¼ ëˆ„ë¥´ë©´ ë©”ëª¨ê°€ ì˜ì›íˆ ì‚¬ë¼ì§‘ë‹ˆë‹¤.
      </p>
    </div>
    <!-- 1ë‹¨ê³„ : ìƒ‰ìƒì„ í•˜ë‚˜ ì„ íƒí•´ì„œ ë©”ëª¨ë¥¼ í•˜ë‚˜ ì¶”ê°€ -->
    <!-- 2ë‹¨ê³„ : formì— ì¸í’‹ì„ ë„£ì–´ì„œ ë³€í™”í•  ìˆ˜ ìˆê²Œ í•¨-->
    <div class="form-body">
      <form id="controller" class="form-style">
        <!-- labelì€ íŠ¹ì •í•œ inputì— ì´ë¦„í‘œë¥¼ ë‹¬ì•„ì£¼ê³ , clickì‹œ í•´ë‹¹ inputì— í¬ì»¤ìŠ¤ë¥¼ ì£¼ëŠ” ê¸°ëŠ¥.
             1) ë¼ë²¨ë¡œ ì¸í’‹ì„ ê°ì‹¼ë‹¤ (ìƒí•˜ìœ„)
             2) for-id -->

        <!-- 7ë‹¨ê³„ : ë©”ëª¨ì— ì™¸ë¶€ ë§í¬ ì—°ê²° ë²„íŠ¼ ë§Œë“¤ê¸° -->
        <!-- 8ë‹¨ê³„ : LLMì„ ì´ì˜í•œ ì¶”ì²œ -->
        <label for="">
          ë©”ëª¨ ë‚´ìš©ì„ ì‘ì„±í•˜ì„¸ìš”!
          <input id="textInput" name="memoText" type="text" />
        </label>
        <label for="">
          ë§í¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”!
          <input name="memoLink" type="url" />
        </label>
        <label for="">
          ë°°ê²½ ìƒ‰ìƒì„ ì„ íƒí•˜ì„¸ìš”!
          <input id="colorInput" name="memoBgColor" type="color" />
        </label>
        <button class="btn-btnstyle">ë§Œë“¤ê¸°</button>
      </form>
    </div>
    <section id="view"></section>

    <script>
      // 5ë‹¨ê³„ ë©”ëª¨ ë°ì´í„° ë³´í˜¸í•˜ê¸° -> onload
      // 6ë‹¨ê³„ ë©”ëª¨ ë³´ì¡´í•˜ê¸°(BOM) -> storage

      // (1) êµ³ì´ ìˆ˜ë™ìœ¼ë¡œë‚˜ í”„ë¡œê·¸ë˜ë°ì ìœ¼ë¡œ ì§€ìš°ì§€ ì•ŠëŠ”ë‹¤ë©´
      // (2) íŠ¹ì • ìš©ëŸ‰ê¹Œì§€ ë³´ì¡´ë˜ëŠ”
      // (3) íŠ¹ì • ì£¼ì†Œì— í• ë‹¹ëœ
      // (4) key-value í˜•íƒœì˜ ë¸Œë¼ìš°ì €ì˜ ì €ì¥ê³µê°„(localStroage)
      //console.log("localStorage", localStorage);

      // (1) íŠ¹ì • í˜ì´ì§€ê°€ ì—´ë ¤ ìˆëŠ” ë™ì•ˆì—ë§Œ ì§€ì†ë˜ëŠ”ëŠ”
      // (2) íŠ¹ì • ìš©ëŸ‰ê¹Œì§€ ë³´ì¡´ë˜ëŠ”
      // (3) íŠ¹ì • ì£¼ì†Œì— í• ë‹¹ëœ
      // (4) key-value í˜•íƒœì˜ ë¸Œë¼ìš°ì €ì˜ ì €ì¥ê³µê°„(sessionStroage)
      //console.log("ssessionStorage", sessionStorage);

      // ì €ì¥ ë²„íŠ¼ì„ 2ê°œë¡œ ë§Œë“¤ì–´ ì°¨ì´ë¥¼ ë³´ì

      // awaintë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ê·¸ê±¸ í¬í•¨í•œ í•¨ìˆ˜ê°€ asyncì—¬ì•¼í•¨
      async function onload() {
        // í•¨ìˆ˜ëŠ” í˜¸ì¶œë§Œ ê°€ëŠ¥í•˜ë‹¤ -> ì ‘ê·¼í•  ìˆ˜ ì—†ë‹¤.
        // ê°œë°œì ë„êµ¬ì—ì„œ ì ‘ê·¼ ë¶ˆê°€!
        // Math.randomì„ ë°”íƒ•ìœ¼ë¡œ hexë¥¼ ìƒì„±í•˜ë˜ ë°°ê²½ìƒ‰ìœ¼ë¡œ ì ì ˆí•œ ì˜…ì€ hex ìƒ‰ìƒì„ ìƒì„±í•˜ëŠ” ìµëª…í•¨ìˆ˜
        //const apiKey = "api key";
        // es 8

        async function useGemeni() {
          // ë¡œì»¬ì—ì„œ ì§ì ‘ api key ì‚¬ìš© ë°©ë²•,
          // ë°°í¬ X
          //const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`;
          //const response = await fetch(url, {
          // method: "POST",
          // body: JSON.stringify({
          //   contents: [
          //     {
          //       parts: [
          //         {
          // geminiì—ê²Œ ë¬»ëŠ” í”„ë¡¬í”„íŠ¸
          //          text: "ë©”ëª¨ì˜ ê¸°ë³¸ ë‚´ìš©ì€ ë­ê°€ ë“¤ì–´ê°€ì•¼í• ê¹Œ? 10ì ì´ë‚´ë¡œ ì“°ê³ , ëì€ 'ë“±ì„ ì‘ì„±í•˜ì„¸ìš”'ë¡œ ëë‚˜ë©´ ì¢‹ê² ì–´",
          //         },
          //       ],
          //    },
          //   ],
          // }),
          // // í•„ìš”í•œ ì˜µì…˜ë“¤ (ì°¨í›„ ì„¤ëª…)
          //  headers: {
          //   "Content-Type": "application/json",
          //  },
          //});
          // jsonì˜ í˜•íƒœë¡œ ì˜¨ ì‘ë‹µì„ ê°ì²´ë¡œ í•´ì„(íŒŒì‹± -> ë³„ë„ë¡œ JSON.parseë¥¼ í•˜ì§„ ì•Šì•„ë„ ì•Œì•„ì„œ ì—­ì§ë ¬í™”í•´ì„œ ê°ì²´ë¡œ ë§Œë“¤ì–´ì¤Œ)
          // const json = await response.json();
          // ê°ì²´ ë‚´ë¶€ì˜ êµ¬ì¡°(í”„ë¡œí¼í‹°, ë°°ì—´, ê°ì²´ ë“±...)ì„ ë¶„ì„í•´ì„œ ë‚´ê°€ ì›í•˜ëŠ” êµ¬ì¡° ë³´ê¸° -> ì˜ ëª¨ë¥´ê² ìœ¼ë©´ api ë¬¸ì„œë‚˜ ë‹¤ë¥¸ ì‚¬ëŒë“¤ ê¸€ ì½ê¸°
          //   console.log(json);
          // return json["candidates"][0]["content"]["parts"][0]["text"];

          // key ë°°í¬ X glitch ì‚¬ìš©
          const url = "https://deadpan-past-calculator.glitch.me";
          const response = await fetch(url);
          return await response.text();
        }
        document.querySelector("#textInput").value = await useGemeni();

        function goodBgColor() {
          return `#${[...Array(3)]
            .map(() => Math.floor(Math.random() * 56) + 200)
            .map((v) => v.toString(16).padStart(2, "0"))
            .join("")}`;
        }
        document.querySelector("#colorInput").value = goodBgColor();
        // 3ë‹¨ê³„ : ë©”ëª¨ ì—¬ëŸ¬ ê°œ ì¶”ê°€
        /*
      const memo = {
        bgColor: "#F0EDCC",
        text: "ì›í•˜ëŠ” ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”. ìƒ‰ìƒê³¼ í•¨ê»˜ ì„ íƒí•˜ì„¸ìš”. ì˜¤ëŠ˜ í•˜ë£¨ë¥¼ ê³µìœ í•´ì£¼ì„¸ìš”",
      };

      */ // í•´ë‹¹ ê°ì²´ê°€ ë°°ì—´ì´ ë˜ì–´ì•¼ í•œë‹¤! (ì—¬ëŸ¬ ê°œê°€ ë˜ë ¤ë©´)

        /* ìŠ¤í† ë¦¬ì§€ë¥¼ ìœ„í•˜ì—¬ ë©”ëª¨ ì‚­ì œ..
         const memoData = [
          // ë°°ì—´ë¡œ ë³€ê²½
          {
            bgColor: goodBgColor(),
            text: "ì›í•˜ëŠ” ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”. ìƒ‰ìƒê³¼ í•¨ê»˜ ì„ íƒí•˜ì„¸ìš”. ì˜¤ëŠ˜ í•˜ë£¨ë¥¼ ê³µìœ í•´ì£¼ì„¸ìš”",
          },
        ];
        */

        // JSON.parseë¥¼ í†µí•´ ë¬¸ìì—´í™” ë˜ì–´ì„œ ì§ë ¬í™”(Serialization, ë©”ëª¨ë¦¬ì— ì €ì¥í•  ìˆ˜ ìˆê²Œ ë³€í™˜)ë˜ì—ˆë˜ ê°ì²´ë¥¼ ë‹¤ì‹œ íŒŒì‹±í•˜ì—¬ ì—­ì§ë ¬í™”(Deserialization)í•˜ì—¬ ê°ì²´í™”í•˜ì—¬ ì €ì¥
        // const memoData = [JSON.parse(localStorage.getItem("memo"))];
        const memoData = [
          ...(JSON.parse(localStorage.getItem("memoStorage")) ?? []),
        ];

        function drawMemo() {
          // #viewë¥¼ ì°¾ì•„ì„œ memoì˜ bgColorë¥¼ ë°°ê²½ìƒ‰ìœ¼ë¡œ í•˜ê³ 
          // textë¥¼ textContentë¡œ í•˜ëŠ” divë¥¼ ë§Œë“œëŠ” í•¨ìˆ˜
          const view = document.querySelector("#view");
          view.innerHTML = ""; // ë¦¬ì…‹

          /*
            view.innerHTML = `<div class="memo-box">${memo.text}</div>`;
            // CSSì˜ í”„ë¡œí¼í‹° -> jsì˜ ê°ì²´
            const memoElement = view.querySelector(".memo-box");
            memoElement.style.backgroundColor = memo.bgColor;
            memoElement.style.padding = "10px";
            */

          for (const memo of memoData) {
            const memoElement = document.createElement("div");
            memoElement.classList.add("memo-box");
            memoElement.textContent = memo.text;
            memoElement.style.backgroundColor = memo.bgColor;
            view.appendChild(memoElement);

            //ë²„íŠ¼ ì»¨í…Œì´ë„ˆ ìƒì„±
            const buttonContainer = document.createElement("div");
            buttonContainer.classList.add("button-container");

            // 4ë‹¨ê³„ : ë©”ëª¨ ì‚­ì œí•˜ê¸°
            // ì‚­ì œ ë²„íŠ¼ì„ ì¶”ê°€
            const deleteButton = document.createElement("button");
            deleteButton.classList.add("btn-btnstyle-2");
            deleteButton.textContent = "ì‚­ì œ"; // í…ìŠ¤íŠ¸
            deleteButton.addEventListener("click", () => {
              // memoData ë°°ì—´ì—ì„œ í•´ë‹¹ ë©”ëª¨ì˜ ì¸ë±ìŠ¤ë¥¼ ì°¾ê¸°
              const index = memoData.indexOf(memo);

              if (index !== -1) {
                memoData.splice(index, 1); // ë°°ì—´ì—ì„œ ì‚­ì œ
              }

              // localStorageì— ì—…ë°ì´íŠ¸ëœ ë°°ì—´ ë‹¤ì‹œ ì €ì¥
              localStorage.setItem("memoStorage", JSON.stringify(memoData));

              // DOMì—ì„œ ì‚­ì œ
              memoElement.remove();
            }); // í•¨ìˆ˜ ê°ì²´ (í™”ì‚´í‘œ í•¨ìˆ˜)
            buttonContainer.appendChild(deleteButton);

            // ë¡œì»¬ ì €ì¥ ë²„íŠ¼
            const localSaveButton = document.createElement("button");
            localSaveButton.textContent = "ë¡œì»¬ ì €ì¥";
            localSaveButton.classList.add("btn-btnstyle-2");
            localSaveButton.addEventListener("click", () => {
              // key, value -> ë‘˜ë‹¤ string.
              //   const memoStr = JSON.stringify(memo); // ì§ë ¬í™”. ë¬¸ìì—´í™”
              //   console.log(memoStr);
              //   localStorage.setItem("memo", memoStr); // ì €ì¥
              // false, [], "", 0, null, undefined
              //   localStorage.clear()
              // ì¸ë±ìŠ¤ë¥¼ ì¡ì•„ì„œ í•´ë‹¹ ê²ƒë§Œ popí•˜ê±°ë‚˜ shiftí•˜ê±°ë‚˜... ì´ëŸ°ê±°...
              /*
              const memoStorage = localStorage.getItem("memoStorage")
                ? localStorage.getItem("memoStorage")
                : "[]";
              console.log(memoStorage);
              const memoStorage2 = JSON.parse(memoStorage);
              console.log(memoStorage2);
              memoStorage2.push(memo);
              console.log(memoStorage2);
              localStorage.setItem("memoStorage", JSON.stringify(memoStorage2));
              */
              localStorage.setItem(
                "memoStorage",
                JSON.stringify([
                  ...(JSON.parse(localStorage.getItem("memoStorage")) ?? []),
                  memo,
                ])
              );
            });
            buttonContainer.appendChild(localSaveButton);
            // ì„¸ì…˜ ì €ì¥ ë²„íŠ¼
            const sessionSaveButton = document.createElement("button");
            sessionSaveButton.classList.add("btn-btnstyle-2");
            sessionSaveButton.textContent = "ì„¸ì…˜ ì €ì¥";
            sessionSaveButton.addEventListener("click", () => {
              sessionStorage.setItem(
                "memoStorage",
                JSON.stringify([
                  ...(JSON.parse(sessionStorage.getItem("memoStorage")) ?? []),
                  memo,
                ])
              );
            });
            buttonContainer.appendChild(sessionSaveButton);

            // ë§í¬ ë²„íŠ¼ì„ ì¶”ê°€í•©ë‹ˆë‹¤ (ìƒˆ ì°½ ì—´ê¸°, í˜„ì¬ ì°½ ì—´ê¸°)
            // console.log(memo.link);
            if (memo.link) {
              //linkë¼ê³  í•˜ëŠ” í”„ë¡œí¼í‹°ë¥¼ í‰ê°€í•´ì„œ ì¡´ì¬í•  ë•Œë§Œ..
              const newLinkButton = document.createElement("button");
              newLinkButton.classList.add("btn-btnstyle-2");
              newLinkButton.textContent = "ìƒˆ ì°½";
              buttonContainer.appendChild(newLinkButton);

              const nowLinkButton = document.createElement("button");
              nowLinkButton.classList.add("btn-btnstyle-2");
              nowLinkButton.textContent = "í˜„ì¬ ì°½";
              buttonContainer.appendChild(nowLinkButton);

              nowLinkButton.addEventListener(
                "click",
                () => (location.href = memo.link)
              );
              newLinkButton.addEventListener("click", () =>
                window.open(memo.link)
              );
            }
            memoElement.appendChild(buttonContainer);
          }
        }

        const controller = document.querySelector("#controller");
        // btnì„ ëˆ„ë¥´ë©´ ì œì¶œ, ì œì¶œì— ëŒ€í•œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        controller.addEventListener(
          "submit", // í˜¸ì´ìŠ¤íŒ…, handleForm ì˜¤ë¥˜X
          function (event) {
            // íƒ€ì… ì¶”ë¡ 
            // #controllerì— listnerë¡œ ë“±ë¡í•  handler, prevent default. (form ê¸°ë³¸ ì œì¶œ)
            // formì— ìˆëŠ” text, color -> memoë¥¼ ìˆ˜ì •
            event.preventDefault(); // ê¸°ë³¸ ì œì¶œì„ ë§‰ìŒ. ì£¼ì†Œ ë’¤ì— `?`ê°€ ì•ˆ ë¶™ëŠ”ë‹¤!
            const form = new FormData(controller);
            const memo = {}; // ì„ì‹œë¡œ ë§Œë“ ë‹¤ // ì´ ê°’ì´ ìœ„ì˜ memoDataì— ë“¤ì–´ê°€ì•¼ë¨
            // console.log(...form.entries);
            memo.text = form.get("memoText");
            memo.bgColor = form.get("memoBgColor");
            memo.link = form.get("memoLink");
            memoData.push(memo);

            drawMemo();
          }
        );
        drawMemo();
      }
      onload();
    </script>
  </body>
</html>
